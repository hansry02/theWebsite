{% extends "base.html" %}

{% block content %}
<head>
	<title>Duelist Tools</title>
	<!--<link rel="stylesheet" href="myStyle.css" type="text/css">-->
	<style>
		body {
			background-color: lightblue;
		}
		.page_title {
			text-align: center;
		}
		#login_container {
			width: 50%;
		}
	</style>
	<script>
		logIn = function() {
			username = document.querySelector('#username').value;
			password = document.querySelector('#password').value;
				
			var req = new XMLHttpRequest();
			req.open("POST", "/login", true);
			req.setRequestHeader("Content-type", "application/json");
			var data = {sentUsername:username,sentPassword:password};
			data.done = true;
			req.send(JSON.stringify(data));
			req.onreadystatechange = function() {
				if (req.readyState == 4 && req.status == 200) {
					confirmation = JSON.parse(req.responseText);
					if (confirmation.tasklist[0] != true) {
						p = document.createElement('p');
						p.appendChild(document.createTextNode('Incorrect username or password'));
						p.style.color = "red";
						
						container = document.querySelector('#login_container');
						container.appendChild(p);
					}
					
					else {
						//checks to remember the username and password locally
						checkbox = document.querySelector('#rememberCheckbox');
						if (checkbox.checked) {	
							localStorage.setItem("username",JSON.stringify(username));
							localStorage.setItem("password",JSON.stringify(password));
						}
						
						window.location = "home.html";
					}
				}
			}
		}
		
		restoreLocalUserInfo = function() {
			rememberedUsername = JSON.parse(localStorage.getItem("username"));
			rememberedPassword = JSON.parse(localStorage.getItem("password"));
			
			username = document.querySelector('#username');
			password = document.querySelector('#password');
			
			username.value = rememberedUsername;
			password.value = rememberedPassword;
		}
		
		window.onload = restoreLocalUserInfo;
	</script>
</head>

<body>
	<h3 class="page_title">Duelist Tools</h3>
	<div class="container" id="login_container">
		<form role="form">
			<div class="form-group">
				<label for="username">Username:</label>
				<input type="text" class="form-control" id="username">
			</div>
			<div class="form-group">
				<label for="password">Password:</label>
				<input type="password" class="form-control" id="password">
			</div>
		</form>
	<button type="button" class="btn btn-primary" onclick="logIn()">Log in</button>
	<button type="button" class="btn btn-default" onclick="location.href='sign-up.html';">Sign-up</button>
	<label class="checkbox-inline"><input type="checkbox" id="rememberCheckbox" value="">Remember me!</label>
	<p><a href="forgotPassword.html">Forgot password?</a></p>
	</div>
</body>
{% endblock %}